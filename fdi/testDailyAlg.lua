require 'calculate_fdi'

local filePath = './fdi/fixtures/graphs_of_interest.txt'

local matlab = {
[1] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 235, [6] = 236, [7] = 237, [8] = 241, [9] = 242, [10] = 250, [11] = 251, [12] = 253, [13] = 256, [14] = 261, [15] = 262, [16] = 263, [17] = 264, [18] = 268, [19] = 273, [20] = 274, [21] = 283, [22] = 300, [23] = 306, [24] = 307, [25] = 333, [26] = 337, [27] = 338, [28] = 351, [29] = 352, [30] = 371, [31] = 372, [32] = 373, [33] = 375, [34] = 376, [35] = 403, [36] = 404, [37] = 405, [38] = 406, [39] = 415, [40] = 420, [41] = 433, [42] = 449, [43] = 489, [44] = 506, [45] = 512},
[2] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 224, [6] = 237, [7] = 238, [8] = 243, [9] = 244, [10] = 261, [11] = 262, [12] = 263, [13] = 264, [14] = 267, [15] = 268, [16] = 269, [17] = 270, [18] = 272, [19] = 273, [20] = 296, [21] = 298, [22] = 299, [23] = 300, [24] = 314, [25] = 327, [26] = 354, [27] = 403, [28] = 404, [29] = 405, [30] = 406, [31] = 411, [32] = 412, [33] = 413, [34] = 414, [35] = 433, [36] = 449, [37] = 489, [38] = 512},
[3] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 223, [6] = 225, [7] = 226, [8] = 245, [9] = 246, [10] = 250, [11] = 251, [12] = 252, [13] = 256, [14] = 257, [15] = 264, [16] = 265, [17] = 276, [18] = 277, [19] = 278, [20] = 279, [21] = 283, [22] = 285, [23] = 286, [24] = 290, [25] = 291, [26] = 292, [27] = 293, [28] = 354, [29] = 382, [30] = 383, [31] = 407, [32] = 408, [33] = 409, [34] = 414, [35] = 415, [36] = 416, [37] = 417, [38] = 433, [39] = 443, [40] = 444, [41] = 489, [42] = 494, [43] = 500, [44] = 503, [45] = 504, [46] = 505, [47] = 506, [48] = 508, [49] = 509, [50] = 510, [51] = 511},
[4] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 185, [6] = 188, [7] = 189, [8] = 190, [9] = 191, [10] = 216, [11] = 217, [12] = 218, [13] = 228, [14] = 230, [15] = 231, [16] = 241, [17] = 242, [18] = 252, [19] = 253, [20] = 254, [21] = 260, [22] = 265, [23] = 266, [24] = 281, [25] = 282, [26] = 283, [27] = 293, [28] = 302, [29] = 315, [30] = 316, [31] = 317, [32] = 323, [33] = 324, [34] = 325, [35] = 326, [36] = 342, [37] = 343, [38] = 344, [39] = 345, [40] = 354, [41] = 361, [42] = 372, [43] = 377, [44] = 378, [45] = 379, [46] = 382, [47] = 390, [48] = 391, [49] = 407, [50] = 489},
[5] = { [1] = 155, [2] = 156, [3] = 157, [4] = 158, [5] = 176, [6] = 220, [7] = 261, [8] = 262, [9] = 263, [10] = 264, [11] = 353, [12] = 354, [13] = 355, [14] = 361, [15] = 403, [16] = 404, [17] = 405, [18] = 406, [19] = 415, [20] = 418, [21] = 419, [22] = 422, [23] = 423, [24] = 424, [25] = 425, [26] = 431, [27] = 432, [28] = 453, [29] = 454, [30] = 455, [31] = 456, [32] = 464, [33] = 489, [34] = 501, [35] = 502, [36] = 512},
[6] = { [1] = 487, [2] = 488, [3] = 489, [4] = 490, [5] = 492, [6] = 493, [7] = 494, [8] = 495, [9] = 497, [10] = 498, [11] = 504, [12] = 505, [13] = 511, [14] = 512},
[7] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 260, [6] = 261, [7] = 266, [8] = 267, [9] = 282, [10] = 320, [11] = 321, [12] = 329, [13] = 330, [14] = 333, [15] = 346, [16] = 349, [17] = 350, [18] = 351, [19] = 352, [20] = 358, [21] = 363, [22] = 364, [23] = 365, [24] = 368, [25] = 372, [26] = 405, [27] = 406, [28] = 407, [29] = 408, [30] = 436, [31] = 437, [32] = 464, [33] = 465, [34] = 489, [35] = 493, [36] = 494, [37] = 503, [38] = 504, [39] = 505, [40] = 506},
[8] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 221, [6] = 222, [7] = 254, [8] = 255, [9] = 260, [10] = 262, [11] = 263, [12] = 270, [13] = 271, [14] = 277, [15] = 278, [16] = 311, [17] = 312, [18] = 313, [19] = 337, [20] = 349, [21] = 354, [22] = 355, [23] = 356, [24] = 357, [25] = 359, [26] = 360, [27] = 361, [28] = 362, [29] = 433, [30] = 463, [31] = 489, [32] = 506, [33] = 512},
[9] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 220, [6] = 226, [7] = 239, [8] = 240, [9] = 242, [10] = 243, [11] = 248, [12] = 249, [13] = 250, [14] = 264, [15] = 265, [16] = 266, [17] = 267, [18] = 273, [19] = 274, [20] = 284, [21] = 288, [22] = 289, [23] = 290, [24] = 294, [25] = 295, [26] = 299, [27] = 301, [28] = 302, [29] = 303, [30] = 309, [31] = 326, [32] = 327, [33] = 348, [34] = 349, [35] = 350, [36] = 351, [37] = 354, [38] = 360, [39] = 361, [40] = 362, [41] = 368, [42] = 369, [43] = 370, [44] = 371, [45] = 373, [46] = 374, [47] = 414, [48] = 428, [49] = 433, [50] = 463, [51] = 489, [52] = 505, [53] = 506, [54] = 511, [55] = 512},
[10] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 220, [6] = 224, [7] = 225, [8] = 229, [9] = 230, [10] = 235, [11] = 236, [12] = 262, [13] = 273, [14] = 274, [15] = 275, [16] = 276, [17] = 280, [18] = 281, [19] = 282, [20] = 283, [21] = 294, [22] = 295, [23] = 296, [24] = 325, [25] = 326, [26] = 354, [27] = 355, [28] = 406, [29] = 407, [30] = 408, [31] = 409, [32] = 419, [33] = 424, [34] = 425, [35] = 426, [36] = 431, [37] = 433, [38] = 479, [39] = 489, [40] = 496, [41] = 497, [42] = 498, [43] = 499, [44] = 501, [45] = 502, [46] = 503, [47] = 504, [48] = 508, [49] = 512},
[11] = { [1] = 436, [2] = 437, [3] = 438, [4] = 439, [5] = 489, [6] = 512},
[12] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 233, [6] = 234, [7] = 261, [8] = 262, [9] = 263, [10] = 264, [11] = 268, [12] = 269, [13] = 280, [14] = 281, [15] = 282, [16] = 403, [17] = 404, [18] = 405, [19] = 406, [20] = 415, [21] = 416, [22] = 418, [23] = 419, [24] = 420, [25] = 422, [26] = 423, [27] = 424, [28] = 425, [29] = 432, [30] = 433, [31] = 448, [32] = 449, [33] = 456, [34] = 489, [35] = 512},
[13] = { [1] = 379, [2] = 380, [3] = 381, [4] = 382, [5] = 408, [6] = 433, [7] = 489, [8] = 512},
[14] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 227, [6] = 228, [7] = 230, [8] = 231, [9] = 243, [10] = 248, [11] = 249, [12] = 254, [13] = 261, [14] = 262, [15] = 263, [16] = 264, [17] = 272, [18] = 273, [19] = 274, [20] = 278, [21] = 279, [22] = 283, [23] = 293, [24] = 294, [25] = 296, [26] = 304, [27] = 305, [28] = 339, [29] = 340, [30] = 350, [31] = 354, [32] = 403, [33] = 404, [34] = 405, [35] = 406, [36] = 409, [37] = 410, [38] = 411, [39] = 412, [40] = 415, [41] = 416, [42] = 431, [43] = 432, [44] = 433, [45] = 463, [46] = 464, [47] = 465, [48] = 489, [49] = 512},
[15] = { [1] = 180, [2] = 181, [3] = 182, [4] = 183, [5] = 295, [6] = 347, [7] = 348, [8] = 369, [9] = 412, [10] = 430, [11] = 431, [12] = 432, [13] = 433, [14] = 438, [15] = 457, [16] = 463, [17] = 464, [18] = 467, [19] = 479, [20] = 487, [21] = 488, [22] = 489, [23] = 490, [24] = 502, [25] = 503, [26] = 504, [27] = 505},
[16] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 225, [6] = 226, [7] = 227, [8] = 228, [9] = 233, [10] = 237, [11] = 238, [12] = 241, [13] = 242, [14] = 252, [15] = 253, [16] = 257, [17] = 258, [18] = 261, [19] = 262, [20] = 263, [21] = 264, [22] = 271, [23] = 291, [24] = 304, [25] = 341, [26] = 354, [27] = 360, [28] = 367, [29] = 368, [30] = 370, [31] = 373, [32] = 403, [33] = 404, [34] = 405, [35] = 406, [36] = 414, [37] = 415, [38] = 416, [39] = 417, [40] = 431, [41] = 432, [42] = 433, [43] = 463, [44] = 464, [45] = 489, [46] = 500, [47] = 501, [48] = 507, [49] = 512},
[17] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 193, [6] = 194, [7] = 195, [8] = 196, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 290, [14] = 291, [15] = 354, [16] = 382, [17] = 383, [18] = 402, [19] = 407, [20] = 408, [21] = 409, [22] = 433, [23] = 444, [24] = 445, [25] = 489, [26] = 494, [27] = 500, [28] = 503, [29] = 504, [30] = 505, [31] = 512},
[18] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 193, [6] = 194, [7] = 195, [8] = 196, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 290, [14] = 291, [15] = 354, [16] = 382, [17] = 383, [18] = 402, [19] = 407, [20] = 408, [21] = 409, [22] = 433, [23] = 444, [24] = 445, [25] = 489, [26] = 494, [27] = 500, [28] = 503, [29] = 504, [30] = 505, [31] = 512},
[19] = { [1] = 181, [2] = 186, [3] = 187, [4] = 188, [5] = 189, [6] = 265, [7] = 490},
[20] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 240, [6] = 282, [7] = 327, [8] = 335, [9] = 354, [10] = 361, [11] = 396, [12] = 433, [13] = 470, [14] = 489, [15] = 505, [16] = 506, [17] = 512},
[21] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 240, [6] = 282, [7] = 327, [8] = 335, [9] = 354, [10] = 361, [11] = 396, [12] = 433, [13] = 470, [14] = 489, [15] = 505, [16] = 506, [17] = 512},
[22] = { [1] = 464, [2] = 465, [3] = 466, [4] = 467, [5] = 469, [6] = 489, [7] = 494, [8] = 495, [9] = 496, [10] = 497, [11] = 499, [12] = 500, [13] = 501, [14] = 502, [15] = 504, [16] = 518, [17] = 519, [18] = 520, [19] = 521, [20] = 525, [21] = 526, [22] = 532, [23] = 533, [24] = 545, [25] = 558, [26] = 583, [27] = 600}
}

local zz = 0

for line in io.lines(filePath) do
	local tokens = {}
	local index = 0
	for token in string.gmatch(line,"[_.%w]+") do
		index = index + 1
		tokens[index] = token
	end

	if(tokens[2] == "1d") then

		zz = zz + 1

		if(zz <= 22) then

			local name = tokens[1]
			--print(name)

			local graph = {}
			local size = index/3 - 1

			for ii = 1,size do
				local triple = {}
				triple[1] = tonumber(tokens[3*ii + 1])
				triple[2] = tonumber(tokens[3*ii + 2])
				triple[3] = tonumber(tokens[3*ii + 3])
				graph[ii] = triple
			end

			local result = calculate_fdi(0, 86400, graph)

			local tdind = 0
			for key,value in pairs(result) do
				if(value[2]) then
						local td = (value[1] - 1357344000) / 86400
						tdind = tdind + 1
						assert(matlab[zz][tdind] == td, string.format('failed test: signal num = %d, alert num = %d, got %d instead of %d', zz, tdind, td, matlab[zz][tdind]))
				end
			end


		end
	end
end
