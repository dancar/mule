-----------------------------------------
-- Test daily algo, Matlab version 33 ---
-----------------------------------------
require 'calculate_fdi'

local filePath = './fdi/fixtures/graphs_of_interest.txt'
--local filePath = './fixtures/graphs_of_interest.txt'

local matlab = {
[1] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 235, [6] = 236, [7] = 237, [8] = 241, [9] = 242, [10] = 250, [11] = 251, [12] = 253, [13] = 256, [14] = 261, [15] = 262, [16] = 263, [17] = 264, [18] = 268, [19] = 273, [20] = 274, [21] = 281, [22] = 283, [23] = 300, [24] = 306, [25] = 307, [26] = 333, [27] = 337, [28] = 338, [29] = 351, [30] = 352, [31] = 371, [32] = 372, [33] = 373, [34] = 375, [35] = 376, [36] = 403, [37] = 404, [38] = 405, [39] = 406, [40] = 415, [41] = 416, [42] = 419, [43] = 420, [44] = 433, [45] = 449, [46] = 450, [47] = 451, [48] = 489, [49] = 506, [50] = 512},
[2] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 224, [6] = 237, [7] = 238, [8] = 243, [9] = 244, [10] = 261, [11] = 262, [12] = 263, [13] = 264, [14] = 267, [15] = 268, [16] = 269, [17] = 270, [18] = 272, [19] = 273, [20] = 296, [21] = 298, [22] = 299, [23] = 314, [24] = 327, [25] = 354, [26] = 403, [27] = 404, [28] = 405, [29] = 406, [30] = 410, [31] = 411, [32] = 412, [33] = 413, [34] = 419, [35] = 423, [36] = 424, [37] = 425, [38] = 433, [39] = 489, [40] = 494, [41] = 512},
[3] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 223, [6] = 225, [7] = 226, [8] = 245, [9] = 246, [10] = 250, [11] = 251, [12] = 252, [13] = 256, [14] = 257, [15] = 264, [16] = 265, [17] = 276, [18] = 277, [19] = 278, [20] = 279, [21] = 283, [22] = 285, [23] = 286, [24] = 289, [25] = 290, [26] = 291, [27] = 292, [28] = 295, [29] = 296, [30] = 297, [31] = 298, [32] = 354, [33] = 382, [34] = 383, [35] = 392, [36] = 407, [37] = 408, [38] = 409, [39] = 412, [40] = 413, [41] = 414, [42] = 415, [43] = 433, [44] = 439, [45] = 445, [46] = 446, [47] = 488, [48] = 489, [49] = 493, [50] = 494, [51] = 499, [52] = 500, [53] = 501, [54] = 502, [55] = 507, [56] = 509, [57] = 510, [58] = 511, [59] = 512},
[4] = { [1] = 179, [2] = 180, [3] = 184, [4] = 185, [5] = 186, [6] = 187, [7] = 190, [8] = 191, [9] = 192, [10] = 193, [11] = 230, [12] = 242, [13] = 253, [14] = 323, [15] = 324, [16] = 325, [17] = 328, [18] = 329, [19] = 330, [20] = 331, [21] = 489},
[5] = { [1] = 155, [2] = 156, [3] = 157, [4] = 158, [5] = 176, [6] = 220, [7] = 250, [8] = 261, [9] = 262, [10] = 263, [11] = 264, [12] = 324, [13] = 353, [14] = 354, [15] = 355, [16] = 356, [17] = 361, [18] = 403, [19] = 404, [20] = 405, [21] = 406, [22] = 414, [23] = 415, [24] = 418, [25] = 419, [26] = 420, [27] = 422, [28] = 423, [29] = 424, [30] = 425, [31] = 428, [32] = 431, [33] = 432, [34] = 433, [35] = 434, [36] = 464, [37] = 465, [38] = 466, [39] = 474, [40] = 475, [41] = 484, [42] = 485, [43] = 486, [44] = 487, [45] = 489, [46] = 512},
[6] = { [1] = 487, [2] = 488, [3] = 489, [4] = 490, [5] = 492, [6] = 493, [7] = 494, [8] = 495, [9] = 497, [10] = 498, [11] = 504, [12] = 505, [13] = 511, [14] = 512},
[7] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 232, [6] = 233, [7] = 260, [8] = 261, [9] = 264, [10] = 265, [11] = 272, [12] = 273, [13] = 274, [14] = 275, [15] = 282, [16] = 320, [17] = 321, [18] = 329, [19] = 330, [20] = 333, [21] = 346, [22] = 349, [23] = 350, [24] = 351, [25] = 352, [26] = 354, [27] = 361, [28] = 369, [29] = 370, [30] = 371, [31] = 372, [32] = 405, [33] = 406, [34] = 407, [35] = 408, [36] = 417, [37] = 418, [38] = 419, [39] = 420, [40] = 428, [41] = 433, [42] = 436, [43] = 437, [44] = 463, [45] = 464, [46] = 465, [47] = 466, [48] = 489, [49] = 493, [50] = 494, [51] = 495, [52] = 501, [53] = 502, [54] = 503, [55] = 504, [56] = 510, [57] = 511, [58] = 512},
[8] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 221, [6] = 222, [7] = 254, [8] = 255, [9] = 260, [10] = 262, [11] = 263, [12] = 270, [13] = 271, [14] = 275, [15] = 276, [16] = 277, [17] = 278, [18] = 311, [19] = 312, [20] = 313, [21] = 337, [22] = 348, [23] = 349, [24] = 352, [25] = 353, [26] = 354, [27] = 355, [28] = 358, [29] = 368, [30] = 372, [31] = 377, [32] = 408, [33] = 409, [34] = 410, [35] = 411, [36] = 433, [37] = 465, [38] = 466, [39] = 489, [40] = 505, [41] = 506, [42] = 510, [43] = 511, [44] = 512},
[9] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 220, [6] = 226, [7] = 239, [8] = 240, [9] = 242, [10] = 243, [11] = 248, [12] = 249, [13] = 250, [14] = 264, [15] = 265, [16] = 266, [17] = 267, [18] = 273, [19] = 274, [20] = 280, [21] = 284, [22] = 288, [23] = 289, [24] = 290, [25] = 294, [26] = 295, [27] = 299, [28] = 301, [29] = 302, [30] = 303, [31] = 304, [32] = 309, [33] = 326, [34] = 327, [35] = 348, [36] = 349, [37] = 350, [38] = 351, [39] = 354, [40] = 360, [41] = 361, [42] = 362, [43] = 368, [44] = 369, [45] = 370, [46] = 371, [47] = 373, [48] = 374, [49] = 382, [50] = 383, [51] = 384, [52] = 414, [53] = 427, [54] = 428, [55] = 433, [56] = 463, [57] = 489, [58] = 504, [59] = 505, [60] = 506, [61] = 509, [62] = 510, [63] = 511, [64] = 512},
[10] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 220, [6] = 224, [7] = 225, [8] = 229, [9] = 230, [10] = 235, [11] = 236, [12] = 262, [13] = 263, [14] = 264, [15] = 265, [16] = 272, [17] = 273, [18] = 274, [19] = 275, [20] = 280, [21] = 281, [22] = 282, [23] = 283, [24] = 294, [25] = 295, [26] = 296, [27] = 325, [28] = 326, [29] = 333, [30] = 351, [31] = 354, [32] = 355, [33] = 361, [34] = 379, [35] = 380, [36] = 381, [37] = 382, [38] = 404, [39] = 405, [40] = 406, [41] = 407, [42] = 415, [43] = 416, [44] = 418, [45] = 419, [46] = 420, [47] = 422, [48] = 423, [49] = 424, [50] = 425, [51] = 428, [52] = 433, [53] = 474, [54] = 475, [55] = 479, [56] = 489, [57] = 496, [58] = 497, [59] = 498, [60] = 499, [61] = 501, [62] = 502, [63] = 503, [64] = 504, [65] = 508, [66] = 512},
[11] = { [1] = 436, [2] = 437, [3] = 438, [4] = 439, [5] = 489, [6] = 512},
[12] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 233, [6] = 234, [7] = 261, [8] = 262, [9] = 263, [10] = 264, [11] = 268, [12] = 269, [13] = 280, [14] = 281, [15] = 282, [16] = 354, [17] = 403, [18] = 404, [19] = 405, [20] = 406, [21] = 415, [22] = 416, [23] = 418, [24] = 419, [25] = 420, [26] = 422, [27] = 423, [28] = 424, [29] = 425, [30] = 428, [31] = 431, [32] = 432, [33] = 433, [34] = 448, [35] = 449, [36] = 455, [37] = 456, [38] = 464, [39] = 477, [40] = 489, [41] = 512},
[13] = { [1] = 379, [2] = 380, [3] = 381, [4] = 382, [5] = 408, [6] = 409, [7] = 410, [8] = 433, [9] = 453, [10] = 454, [11] = 489, [12] = 512},
[14] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 227, [6] = 228, [7] = 230, [8] = 231, [9] = 243, [10] = 248, [11] = 249, [12] = 254, [13] = 261, [14] = 262, [15] = 263, [16] = 264, [17] = 272, [18] = 273, [19] = 274, [20] = 278, [21] = 279, [22] = 283, [23] = 293, [24] = 294, [25] = 296, [26] = 304, [27] = 305, [28] = 339, [29] = 340, [30] = 341, [31] = 350, [32] = 354, [33] = 361, [34] = 403, [35] = 404, [36] = 405, [37] = 406, [38] = 409, [39] = 410, [40] = 411, [41] = 412, [42] = 414, [43] = 416, [44] = 431, [45] = 432, [46] = 433, [47] = 463, [48] = 464, [49] = 465, [50] = 466, [51] = 489, [52] = 512},
[15] = { [1] = 292, [2] = 295, [3] = 320, [4] = 347, [5] = 348, [6] = 369, [7] = 412, [8] = 430, [9] = 431, [10] = 432, [11] = 433, [12] = 438, [13] = 464, [14] = 465, [15] = 466, [16] = 467, [17] = 505},
[16] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 225, [6] = 226, [7] = 227, [8] = 228, [9] = 233, [10] = 237, [11] = 238, [12] = 241, [13] = 242, [14] = 252, [15] = 253, [16] = 257, [17] = 258, [18] = 261, [19] = 262, [20] = 263, [21] = 264, [22] = 271, [23] = 291, [24] = 304, [25] = 341, [26] = 354, [27] = 360, [28] = 367, [29] = 368, [30] = 370, [31] = 373, [32] = 403, [33] = 404, [34] = 405, [35] = 406, [36] = 412, [37] = 413, [38] = 414, [39] = 415, [40] = 419, [41] = 420, [42] = 421, [43] = 422, [44] = 431, [45] = 432, [46] = 433, [47] = 463, [48] = 464, [49] = 489, [50] = 497, [51] = 498, [52] = 499, [53] = 500, [54] = 507, [55] = 512},
[17] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 193, [6] = 194, [7] = 195, [8] = 196, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 354, [14] = 382, [15] = 383, [16] = 402, [17] = 406, [18] = 407, [19] = 408, [20] = 409, [21] = 433, [22] = 439, [23] = 440, [24] = 441, [25] = 442, [26] = 489, [27] = 490, [28] = 494, [29] = 500, [30] = 501, [31] = 502, [32] = 503, [33] = 506, [34] = 507, [35] = 508, [36] = 509, [37] = 512},
[18] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 193, [6] = 194, [7] = 195, [8] = 196, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 354, [14] = 382, [15] = 383, [16] = 402, [17] = 406, [18] = 407, [19] = 408, [20] = 409, [21] = 433, [22] = 439, [23] = 440, [24] = 441, [25] = 442, [26] = 489, [27] = 490, [28] = 494, [29] = 500, [30] = 501, [31] = 502, [32] = 503, [33] = 506, [34] = 507, [35] = 508, [36] = 509, [37] = 512},
[19] = {},
[20] = { [1] = 179, [2] = 181, [3] = 184, [4] = 185, [5] = 186, [6] = 187, [7] = 240, [8] = 282, [9] = 327, [10] = 335, [11] = 354, [12] = 361, [13] = 366, [14] = 380, [15] = 396, [16] = 433, [17] = 470, [18] = 489, [19] = 505, [20] = 506, [21] = 512},
[21] = { [1] = 179, [2] = 181, [3] = 184, [4] = 185, [5] = 186, [6] = 187, [7] = 240, [8] = 282, [9] = 327, [10] = 335, [11] = 354, [12] = 361, [13] = 366, [14] = 380, [15] = 396, [16] = 433, [17] = 470, [18] = 489, [19] = 505, [20] = 506, [21] = 512},
[22] = { [1] = 464, [2] = 467, [3] = 468, [4] = 472, [5] = 473, [6] = 474, [7] = 475, [8] = 496, [9] = 502, [10] = 503, [11] = 504, [12] = 505, [13] = 521, [14] = 522, [15] = 523, [16] = 524, [17] = 528, [18] = 529, [19] = 530, [20] = 531, [21] = 558, [22] = 583, [23] = 591, [24] = 592, [25] = 593, [26] = 600},
[23] = {},
[24] = { [1] = 521, [2] = 522, [3] = 523, [4] = 528, [5] = 529, [6] = 530, [7] = 534, [8] = 535, [9] = 536, [10] = 537, [11] = 540, [12] = 553, [13] = 554, [14] = 555, [15] = 556}
}

local zz = 0

for line in io.lines(filePath) do
	local tokens = {}
	local index = 0
	for token in string.gmatch(line,"[_.%w]+") do
		index = index + 1
		tokens[index] = token
	end

	if(tokens[2] == "1d") then

		zz = zz + 1

		if(zz >= 1 and zz <= 24) then

			local name = tokens[1]
			--print(name)

			local graph = {}
			local size = index/3 - 1

			for ii = 1,size do
				local triple = {}
				triple[1] = tonumber(tokens[3*ii + 1])
				triple[2] = tonumber(tokens[3*ii + 2])
				triple[3] = tonumber(tokens[3*ii + 3])
				graph[ii] = triple
			end

			local result = calculate_fdi(0, 86400, graph)

			local tdind = 0
			for key,value in pairs(result) do
				if(value[2]) then
						local td = (value[1] - 1357344000) / 86400
						tdind = tdind + 1
						assert(matlab[zz][tdind] == td, string.format('failed test: signal num = %d, alert num = %d, got %d instead of %d', zz, tdind, td, matlab[zz][tdind]))
				end
			end

		end
	end
end



