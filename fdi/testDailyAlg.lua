require 'calculate_fdi'

local filePath = './fdi/fixtures/graphs_of_interest.txt'

local matlab = {
[1] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 235, [6] = 236, [7] = 237, [8] = 241, [9] = 242, [10] = 250, [11] = 251, [12] = 253, [13] = 256, [14] = 261, [15] = 262, [16] = 263, [17] = 264, [18] = 268, [19] = 273, [20] = 274, [21] = 283, [22] = 300, [23] = 306, [24] = 307, [25] = 333, [26] = 337, [27] = 338, [28] = 351, [29] = 352, [30] = 371, [31] = 372, [32] = 373, [33] = 375, [34] = 376, [35] = 403, [36] = 404, [37] = 405, [38] = 406, [39] = 415, [40] = 420, [41] = 433, [42] = 450, [43] = 451, [44] = 489, [45] = 506, [46] = 512},
[2] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 224, [6] = 237, [7] = 238, [8] = 243, [9] = 244, [10] = 261, [11] = 262, [12] = 263, [13] = 264, [14] = 267, [15] = 268, [16] = 269, [17] = 270, [18] = 272, [19] = 273, [20] = 296, [21] = 298, [22] = 299, [23] = 300, [24] = 314, [25] = 327, [26] = 354, [27] = 403, [28] = 404, [29] = 405, [30] = 406, [31] = 411, [32] = 412, [33] = 413, [34] = 414, [35] = 433, [36] = 449, [37] = 489, [38] = 512},
[3] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 223, [6] = 225, [7] = 226, [8] = 245, [9] = 246, [10] = 250, [11] = 251, [12] = 252, [13] = 256, [14] = 257, [15] = 264, [16] = 265, [17] = 276, [18] = 277, [19] = 278, [20] = 279, [21] = 283, [22] = 285, [23] = 286, [24] = 290, [25] = 291, [26] = 292, [27] = 293, [28] = 354, [29] = 382, [30] = 383, [31] = 407, [32] = 408, [33] = 409, [34] = 414, [35] = 415, [36] = 416, [37] = 417, [38] = 433, [39] = 444, [40] = 445, [41] = 489, [42] = 494, [43] = 500, [44] = 503, [45] = 504, [46] = 505, [47] = 506, [48] = 508, [49] = 509, [50] = 510, [51] = 511},
[4] = { [1] = 179, [2] = 180, [3] = 184, [4] = 185, [5] = 186, [6] = 187, [7] = 190, [8] = 191, [9] = 192, [10] = 193, [11] = 206, [12] = 217, [13] = 228, [14] = 230, [15] = 241, [16] = 242, [17] = 253, [18] = 254, [19] = 266, [20] = 323, [21] = 324, [22] = 325, [23] = 328, [24] = 329, [25] = 330, [26] = 331, [27] = 344, [28] = 345, [29] = 353, [30] = 354, [31] = 361, [32] = 381, [33] = 489},
[5] = { [1] = 155, [2] = 156, [3] = 157, [4] = 158, [5] = 176, [6] = 220, [7] = 261, [8] = 262, [9] = 263, [10] = 264, [11] = 353, [12] = 354, [13] = 355, [14] = 361, [15] = 403, [16] = 404, [17] = 405, [18] = 406, [19] = 415, [20] = 418, [21] = 419, [22] = 422, [23] = 423, [24] = 424, [25] = 425, [26] = 431, [27] = 432, [28] = 455, [29] = 456, [30] = 464, [31] = 489},
[6] = { [1] = 487, [2] = 488, [3] = 489, [4] = 490, [5] = 492, [6] = 493, [7] = 494, [8] = 495, [9] = 497, [10] = 498, [11] = 504, [12] = 505, [13] = 511, [14] = 512},
[7] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 260, [6] = 261, [7] = 265, [8] = 282, [9] = 320, [10] = 321, [11] = 329, [12] = 330, [13] = 333, [14] = 346, [15] = 349, [16] = 350, [17] = 351, [18] = 352, [19] = 358, [20] = 363, [21] = 364, [22] = 365, [23] = 368, [24] = 369, [25] = 373, [26] = 374, [27] = 375, [28] = 376, [29] = 405, [30] = 406, [31] = 407, [32] = 408, [33] = 419, [34] = 436, [35] = 437, [36] = 463, [37] = 489, [38] = 493, [39] = 494, [40] = 503, [41] = 504, [42] = 505, [43] = 506},
[8] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 221, [6] = 222, [7] = 254, [8] = 255, [9] = 260, [10] = 262, [11] = 263, [12] = 270, [13] = 271, [14] = 277, [15] = 278, [16] = 311, [17] = 312, [18] = 313, [19] = 337, [20] = 349, [21] = 354, [22] = 355, [23] = 356, [24] = 357, [25] = 359, [26] = 360, [27] = 361, [28] = 362, [29] = 372, [30] = 433, [31] = 463, [32] = 489, [33] = 506, [34] = 512},
[9] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 220, [6] = 226, [7] = 239, [8] = 240, [9] = 242, [10] = 243, [11] = 248, [12] = 249, [13] = 250, [14] = 264, [15] = 265, [16] = 266, [17] = 267, [18] = 273, [19] = 274, [20] = 280, [21] = 281, [22] = 284, [23] = 287, [24] = 289, [25] = 290, [26] = 299, [27] = 302, [28] = 303, [29] = 304, [30] = 308, [31] = 309, [32] = 315, [33] = 316, [34] = 326, [35] = 327, [36] = 348, [37] = 349, [38] = 350, [39] = 351, [40] = 354, [41] = 360, [42] = 361, [43] = 362, [44] = 368, [45] = 369, [46] = 370, [47] = 371, [48] = 373, [49] = 374, [50] = 428, [51] = 433, [52] = 463, [53] = 489, [54] = 505, [55] = 506, [56] = 511, [57] = 512},
[10] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 220, [6] = 224, [7] = 225, [8] = 229, [9] = 230, [10] = 235, [11] = 236, [12] = 262, [13] = 273, [14] = 274, [15] = 275, [16] = 276, [17] = 280, [18] = 281, [19] = 282, [20] = 283, [21] = 294, [22] = 295, [23] = 296, [24] = 325, [25] = 326, [26] = 354, [27] = 406, [28] = 407, [29] = 408, [30] = 409, [31] = 419, [32] = 424, [33] = 425, [34] = 426, [35] = 432, [36] = 433, [37] = 434, [38] = 478, [39] = 479, [40] = 489, [41] = 496, [42] = 497, [43] = 498, [44] = 499, [45] = 501, [46] = 502, [47] = 503, [48] = 504, [49] = 508, [50] = 512},
[11] = { [1] = 436, [2] = 437, [3] = 438, [4] = 439, [5] = 489, [6] = 512},
[12] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 233, [6] = 234, [7] = 261, [8] = 262, [9] = 263, [10] = 264, [11] = 268, [12] = 269, [13] = 280, [14] = 281, [15] = 282, [16] = 354, [17] = 403, [18] = 404, [19] = 405, [20] = 406, [21] = 415, [22] = 416, [23] = 418, [24] = 419, [25] = 420, [26] = 422, [27] = 423, [28] = 424, [29] = 425, [30] = 431, [31] = 433, [32] = 448, [33] = 449, [34] = 456, [35] = 489, [36] = 512},
[13] = { [1] = 379, [2] = 380, [3] = 381, [4] = 382, [5] = 408, [6] = 409, [7] = 433, [8] = 489, [9] = 512},
[14] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 227, [6] = 228, [7] = 230, [8] = 231, [9] = 243, [10] = 248, [11] = 249, [12] = 254, [13] = 261, [14] = 262, [15] = 263, [16] = 264, [17] = 272, [18] = 273, [19] = 274, [20] = 278, [21] = 279, [22] = 283, [23] = 293, [24] = 294, [25] = 296, [26] = 304, [27] = 305, [28] = 339, [29] = 340, [30] = 341, [31] = 350, [32] = 354, [33] = 361, [34] = 403, [35] = 404, [36] = 405, [37] = 406, [38] = 409, [39] = 410, [40] = 411, [41] = 412, [42] = 415, [43] = 416, [44] = 431, [45] = 432, [46] = 433, [47] = 463, [48] = 464, [49] = 465, [50] = 489, [51] = 512},
[15] = { [1] = 295, [2] = 347, [3] = 348, [4] = 369, [5] = 412, [6] = 430, [7] = 431, [8] = 432, [9] = 433, [10] = 438, [11] = 457, [12] = 458, [13] = 459, [14] = 460, [15] = 463, [16] = 464, [17] = 467, [18] = 479, [19] = 487, [20] = 488, [21] = 489, [22] = 490, [23] = 502, [24] = 503, [25] = 504, [26] = 505},
[16] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 225, [6] = 226, [7] = 227, [8] = 228, [9] = 233, [10] = 237, [11] = 238, [12] = 241, [13] = 242, [14] = 252, [15] = 253, [16] = 257, [17] = 258, [18] = 261, [19] = 262, [20] = 263, [21] = 264, [22] = 271, [23] = 291, [24] = 304, [25] = 354, [26] = 360, [27] = 367, [28] = 368, [29] = 370, [30] = 373, [31] = 403, [32] = 404, [33] = 405, [34] = 406, [35] = 414, [36] = 415, [37] = 416, [38] = 417, [39] = 431, [40] = 432, [41] = 433, [42] = 463, [43] = 464, [44] = 489, [45] = 500, [46] = 501, [47] = 507, [48] = 512},
[17] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 193, [6] = 194, [7] = 195, [8] = 196, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 289, [14] = 290, [15] = 291, [16] = 354, [17] = 382, [18] = 383, [19] = 402, [20] = 407, [21] = 408, [22] = 409, [23] = 433, [24] = 444, [25] = 445, [26] = 489, [27] = 494, [28] = 500, [29] = 503, [30] = 504, [31] = 505, [32] = 512},
[18] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 193, [6] = 194, [7] = 195, [8] = 196, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 289, [14] = 290, [15] = 291, [16] = 354, [17] = 382, [18] = 383, [19] = 402, [20] = 407, [21] = 408, [22] = 409, [23] = 433, [24] = 444, [25] = 445, [26] = 489, [27] = 494, [28] = 500, [29] = 503, [30] = 504, [31] = 505, [32] = 512},
[19] = {},
[20] = { [1] = 179, [2] = 181, [3] = 184, [4] = 185, [5] = 186, [6] = 187, [7] = 240, [8] = 327, [9] = 338, [10] = 354, [11] = 361, [12] = 367, [13] = 396, [14] = 433, [15] = 489, [16] = 506, [17] = 512},
[21] = { [1] = 179, [2] = 181, [3] = 184, [4] = 185, [5] = 186, [6] = 187, [7] = 240, [8] = 327, [9] = 338, [10] = 354, [11] = 361, [12] = 367, [13] = 396, [14] = 433, [15] = 489, [16] = 506, [17] = 512},
[22] = { [1] = 464, [2] = 467, [3] = 468, [4] = 472, [5] = 473, [6] = 474, [7] = 475, [8] = 489, [9] = 494, [10] = 495, [11] = 496, [12] = 499, [13] = 500, [14] = 501, [15] = 502, [16] = 504, [17] = 520, [18] = 521, [19] = 522, [20] = 523, [21] = 525, [22] = 526, [23] = 532, [24] = 533, [25] = 545, [26] = 558, [27] = 583, [28] = 592, [29] = 600},
[23] = {},
[24] = { [1] = 521, [2] = 522, [3] = 523, [4] = 528, [5] = 529, [6] = 530, [7] = 534, [8] = 535, [9] = 536, [10] = 537, [11] = 540, [12] = 548, [13] = 549, [14] = 551, [15] = 553, [16] = 554, [17] = 555, [18] = 556, [19] = 561, [20] = 565, [21] = 569, [22] = 570, [23] = 576, [24] = 582, [25] = 586, [26] = 589, [27] = 591, [28] = 592, [29] = 593, [30] = 596, [31] = 597, [32] = 600, [33] = 604, [34] = 606, [35] = 613}
}

local zz = 0

for line in io.lines(filePath) do
	local tokens = {}
	local index = 0
	for token in string.gmatch(line,"[_.%w]+") do
		index = index + 1
		tokens[index] = token
	end

	if(tokens[2] == "1d") then

		zz = zz + 1

		if(zz == 22) then

			local name = tokens[1]
			--print(name)

			local graph = {}
			local size = index/3 - 1

			for ii = 1,size do
				local triple = {}
				triple[1] = tonumber(tokens[3*ii + 1])
				triple[2] = tonumber(tokens[3*ii + 2])
				triple[3] = tonumber(tokens[3*ii + 3])
				graph[ii] = triple
			end

			local result = calculate_fdi(0, 86400, graph)

			local tdind = 0
			for key,value in pairs(result) do
				if(value[2]) then
						local td = (value[1] - 1357344000) / 86400
						tdind = tdind + 1
						assert(matlab[zz][tdind] == td, string.format('failed test: signal num = %d, alert num = %d, got %d instead of %d', zz, tdind, td, matlab[zz][tdind]))
				end
			end


		end
	end
end
