-----------------------------------------
-- Test daily algo, Matlab version 34 ---
-----------------------------------------
require 'calculate_fdi'

local filePath = './fdi/fixtures/graphs_of_interest.txt'

local matlab = {
[1] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 235, [6] = 236, [7] = 237, [8] = 241, [9] = 242, [10] = 250, [11] = 251, [12] = 253, [13] = 256, [14] = 261, [15] = 262, [16] = 263, [17] = 264, [18] = 268, [19] = 273, [20] = 274, [21] = 281, [22] = 283, [23] = 300, [24] = 306, [25] = 307, [26] = 333, [27] = 337, [28] = 338, [29] = 351, [30] = 352, [31] = 371, [32] = 372, [33] = 373, [34] = 375, [35] = 376, [36] = 403, [37] = 404, [38] = 405, [39] = 406, [40] = 415, [41] = 416, [42] = 419, [43] = 420, [44] = 433, [45] = 449, [46] = 450, [47] = 451, [48] = 489, [49] = 506, [50] = 512},
[2] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 224, [6] = 237, [7] = 238, [8] = 243, [9] = 244, [10] = 261, [11] = 262, [12] = 263, [13] = 264, [14] = 267, [15] = 268, [16] = 269, [17] = 270, [18] = 272, [19] = 273, [20] = 296, [21] = 298, [22] = 299, [23] = 314, [24] = 327, [25] = 354, [26] = 403, [27] = 404, [28] = 405, [29] = 406, [30] = 410, [31] = 411, [32] = 412, [33] = 413, [34] = 419, [35] = 423, [36] = 424, [37] = 425, [38] = 433, [39] = 489, [40] = 494, [41] = 512},
[3] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 223, [6] = 225, [7] = 226, [8] = 245, [9] = 246, [10] = 250, [11] = 251, [12] = 252, [13] = 256, [14] = 257, [15] = 264, [16] = 265, [17] = 276, [18] = 277, [19] = 278, [20] = 279, [21] = 283, [22] = 285, [23] = 286, [24] = 289, [25] = 290, [26] = 291, [27] = 292, [28] = 295, [29] = 296, [30] = 297, [31] = 298, [32] = 354, [33] = 382, [34] = 383, [35] = 392, [36] = 407, [37] = 408, [38] = 409, [39] = 412, [40] = 413, [41] = 414, [42] = 415, [43] = 433, [44] = 439, [45] = 445, [46] = 446, [47] = 488, [48] = 489, [49] = 493, [50] = 494, [51] = 499, [52] = 500, [53] = 501, [54] = 502, [55] = 507, [56] = 509, [57] = 510, [58] = 511, [59] = 512},
[4] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 184, [6] = 185, [7] = 186, [8] = 187, [9] = 189, [10] = 190, [11] = 191, [12] = 192, [13] = 195, [14] = 201, [15] = 202, [16] = 203, [17] = 204, [18] = 217, [19] = 218, [20] = 231, [21] = 242, [22] = 253, [23] = 323, [24] = 324, [25] = 325, [26] = 328, [27] = 329, [28] = 330, [29] = 331, [30] = 489},
[5] = { [1] = 155, [2] = 156, [3] = 157, [4] = 158, [5] = 176, [6] = 180, [7] = 183, [8] = 189, [9] = 220, [10] = 241, [11] = 250, [12] = 261, [13] = 262, [14] = 263, [15] = 264, [16] = 324, [17] = 353, [18] = 354, [19] = 355, [20] = 356, [21] = 361, [22] = 403, [23] = 404, [24] = 405, [25] = 406, [26] = 414, [27] = 415, [28] = 418, [29] = 419, [30] = 420, [31] = 422, [32] = 423, [33] = 424, [34] = 425, [35] = 428, [36] = 431, [37] = 432, [38] = 433, [39] = 434, [40] = 464, [41] = 465, [42] = 466, [43] = 474, [44] = 475, [45] = 484, [46] = 485, [47] = 486, [48] = 487, [49] = 489, [50] = 512},
[6] = { [1] = 487, [2] = 488, [3] = 489, [4] = 490, [5] = 492, [6] = 493, [7] = 494, [8] = 495, [9] = 497, [10] = 498, [11] = 504, [12] = 505, [13] = 511, [14] = 512},
[7] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 188, [6] = 226, [7] = 227, [8] = 231, [9] = 232, [10] = 233, [11] = 239, [12] = 244, [13] = 260, [14] = 261, [15] = 264, [16] = 265, [17] = 266, [18] = 267, [19] = 282, [20] = 320, [21] = 321, [22] = 329, [23] = 330, [24] = 333, [25] = 346, [26] = 347, [27] = 348, [28] = 349, [29] = 361, [30] = 365, [31] = 368, [32] = 369, [33] = 370, [34] = 371, [35] = 381, [36] = 382, [37] = 383, [38] = 384, [39] = 405, [40] = 406, [41] = 407, [42] = 408, [43] = 416, [44] = 420, [45] = 429, [46] = 433, [47] = 436, [48] = 437, [49] = 463, [50] = 489, [51] = 493, [52] = 494, [53] = 495, [54] = 501, [55] = 502, [56] = 503, [57] = 504, [58] = 510},
[8] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 221, [6] = 222, [7] = 254, [8] = 255, [9] = 260, [10] = 262, [11] = 263, [12] = 270, [13] = 271, [14] = 275, [15] = 276, [16] = 277, [17] = 278, [18] = 311, [19] = 312, [20] = 313, [21] = 337, [22] = 348, [23] = 349, [24] = 352, [25] = 353, [26] = 354, [27] = 355, [28] = 358, [29] = 368, [30] = 372, [31] = 377, [32] = 408, [33] = 409, [34] = 410, [35] = 411, [36] = 433, [37] = 465, [38] = 466, [39] = 489, [40] = 505, [41] = 506, [42] = 510, [43] = 511, [44] = 512},
[9] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 220, [6] = 226, [7] = 239, [8] = 240, [9] = 242, [10] = 243, [11] = 248, [12] = 249, [13] = 250, [14] = 264, [15] = 265, [16] = 266, [17] = 267, [18] = 273, [19] = 274, [20] = 280, [21] = 284, [22] = 288, [23] = 289, [24] = 290, [25] = 294, [26] = 295, [27] = 299, [28] = 301, [29] = 302, [30] = 303, [31] = 304, [32] = 309, [33] = 326, [34] = 327, [35] = 348, [36] = 349, [37] = 350, [38] = 351, [39] = 354, [40] = 360, [41] = 361, [42] = 362, [43] = 368, [44] = 369, [45] = 370, [46] = 371, [47] = 373, [48] = 374, [49] = 382, [50] = 383, [51] = 384, [52] = 414, [53] = 427, [54] = 428, [55] = 433, [56] = 463, [57] = 489, [58] = 504, [59] = 505, [60] = 506, [61] = 509, [62] = 510, [63] = 511, [64] = 512},
[10] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 188, [6] = 220, [7] = 224, [8] = 225, [9] = 229, [10] = 230, [11] = 235, [12] = 236, [13] = 261, [14] = 262, [15] = 265, [16] = 266, [17] = 267, [18] = 272, [19] = 273, [20] = 274, [21] = 276, [22] = 294, [23] = 295, [24] = 296, [25] = 325, [26] = 326, [27] = 351, [28] = 354, [29] = 355, [30] = 361, [31] = 379, [32] = 404, [33] = 405, [34] = 406, [35] = 407, [36] = 416, [37] = 419, [38] = 420, [39] = 423, [40] = 424, [41] = 425, [42] = 426, [43] = 431, [44] = 432, [45] = 433, [46] = 434, [47] = 439, [48] = 440, [49] = 475, [50] = 489, [51] = 496, [52] = 497, [53] = 498, [54] = 499, [55] = 501, [56] = 502, [57] = 503, [58] = 504, [59] = 508, [60] = 509, [61] = 512},
[11] = { [1] = 436, [2] = 437, [3] = 438, [4] = 439, [5] = 489, [6] = 512},
[12] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 233, [6] = 234, [7] = 261, [8] = 262, [9] = 263, [10] = 264, [11] = 268, [12] = 269, [13] = 280, [14] = 281, [15] = 282, [16] = 354, [17] = 403, [18] = 404, [19] = 405, [20] = 406, [21] = 415, [22] = 416, [23] = 418, [24] = 419, [25] = 420, [26] = 422, [27] = 423, [28] = 424, [29] = 425, [30] = 428, [31] = 431, [32] = 432, [33] = 433, [34] = 448, [35] = 449, [36] = 455, [37] = 456, [38] = 464, [39] = 477, [40] = 489, [41] = 512},
[13] = { [1] = 379, [2] = 380, [3] = 381, [4] = 382, [5] = 395, [6] = 398, [7] = 399, [8] = 400, [9] = 403, [10] = 404, [11] = 408, [12] = 409, [13] = 410, [14] = 411, [15] = 433, [16] = 453, [17] = 454, [18] = 489, [19] = 512},
[14] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 186, [6] = 187, [7] = 188, [8] = 194, [9] = 195, [10] = 208, [11] = 227, [12] = 228, [13] = 230, [14] = 231, [15] = 243, [16] = 248, [17] = 249, [18] = 254, [19] = 261, [20] = 262, [21] = 263, [22] = 264, [23] = 272, [24] = 273, [25] = 274, [26] = 278, [27] = 279, [28] = 283, [29] = 293, [30] = 294, [31] = 296, [32] = 304, [33] = 305, [34] = 339, [35] = 340, [36] = 341, [37] = 350, [38] = 354, [39] = 361, [40] = 403, [41] = 404, [42] = 405, [43] = 406, [44] = 409, [45] = 410, [46] = 411, [47] = 412, [48] = 414, [49] = 416, [50] = 431, [51] = 432, [52] = 433, [53] = 463, [54] = 464, [55] = 465, [56] = 466, [57] = 489, [58] = 512},
[15] = { [1] = 292, [2] = 295, [3] = 320, [4] = 347, [5] = 348, [6] = 369, [7] = 412, [8] = 430, [9] = 431, [10] = 432, [11] = 433, [12] = 438, [13] = 464, [14] = 465, [15] = 466, [16] = 467, [17] = 505},
[16] = { [1] = 178, [2] = 179, [3] = 180, [4] = 181, [5] = 225, [6] = 226, [7] = 227, [8] = 228, [9] = 233, [10] = 237, [11] = 238, [12] = 241, [13] = 242, [14] = 252, [15] = 253, [16] = 257, [17] = 258, [18] = 261, [19] = 262, [20] = 263, [21] = 264, [22] = 271, [23] = 291, [24] = 304, [25] = 341, [26] = 354, [27] = 360, [28] = 367, [29] = 368, [30] = 370, [31] = 373, [32] = 403, [33] = 404, [34] = 405, [35] = 406, [36] = 412, [37] = 413, [38] = 414, [39] = 415, [40] = 419, [41] = 420, [42] = 421, [43] = 422, [44] = 431, [45] = 432, [46] = 433, [47] = 463, [48] = 464, [49] = 489, [50] = 497, [51] = 498, [52] = 499, [53] = 500, [54] = 507, [55] = 512},
[17] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 192, [6] = 193, [7] = 194, [8] = 195, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 291, [14] = 354, [15] = 382, [16] = 383, [17] = 402, [18] = 406, [19] = 407, [20] = 408, [21] = 409, [22] = 433, [23] = 439, [24] = 440, [25] = 441, [26] = 442, [27] = 489, [28] = 490, [29] = 494, [30] = 500, [31] = 501, [32] = 502, [33] = 503, [34] = 506, [35] = 507, [36] = 508, [37] = 509, [38] = 512},
[18] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 192, [6] = 193, [7] = 194, [8] = 195, [9] = 260, [10] = 261, [11] = 262, [12] = 263, [13] = 291, [14] = 354, [15] = 382, [16] = 383, [17] = 402, [18] = 406, [19] = 407, [20] = 408, [21] = 409, [22] = 433, [23] = 439, [24] = 440, [25] = 441, [26] = 442, [27] = 489, [28] = 490, [29] = 494, [30] = 500, [31] = 501, [32] = 502, [33] = 503, [34] = 506, [35] = 507, [36] = 508, [37] = 509, [38] = 512},
[19] = {},
[20] = { [1] = 179, [2] = 180, [3] = 181, [4] = 182, [5] = 185, [6] = 186, [7] = 187, [8] = 188, [9] = 192, [10] = 193, [11] = 194, [12] = 195, [13] = 240, [14] = 282, [15] = 327, [16] = 335, [17] = 354, [18] = 361, [19] = 366, [20] = 380, [21] = 396, [22] = 433, [23] = 470, [24] = 489, [25] = 505, [26] = 506, [27] = 512},
[21] = { [1] = 464, [2] = 465, [3] = 466, [4] = 467, [5] = 469, [6] = 470, [7] = 489, [8] = 494, [9] = 495, [10] = 496, [11] = 499, [12] = 500, [13] = 501, [14] = 502, [15] = 520, [16] = 521, [17] = 522, [18] = 523, [19] = 525, [20] = 526, [21] = 532, [22] = 533, [23] = 545, [24] = 558, [25] = 583, [26] = 587, [27] = 591, [28] = 592, [29] = 593, [30] = 600},
[22] = {},
[23] = { [1] = 520, [2] = 521, [3] = 522, [4] = 523, [5] = 527, [6] = 528, [7] = 529, [8] = 530, [9] = 533, [10] = 534, [11] = 535, [12] = 536, [13] = 538, [14] = 539, [15] = 541, [16] = 542, [17] = 543, [18] = 544, [19] = 548, [20] = 549, [21] = 551, [22] = 554, [23] = 555, [24] = 556},
[24] = { [1] = 462, [2] = 463, [3] = 464, [4] = 465, [5] = 489, [6] = 494, [7] = 500, [8] = 501, [9] = 502, [10] = 503, [11] = 507, [12] = 509, [13] = 510, [14] = 511, [15] = 512, [16] = 518, [17] = 519, [18] = 520, [19] = 521, [20] = 527, [21] = 528, [22] = 538, [23] = 539, [24] = 540, [25] = 541, [26] = 558, [27] = 583, [28] = 590, [29] = 591, [30] = 636, [31] = 637, [32] = 638, [33] = 644, [34] = 645, [35] = 646, [36] = 647}
}

local zz = 0

for line in io.lines(filePath) do
	local tokens = {}
	local index = 0
	for token in string.gmatch(line,"[_.%w]+") do
		index = index + 1
		tokens[index] = token
	end

	if(tokens[2] == "1d") then

		zz = zz + 1

		if(zz >= 1 and zz <= 24) then

			local name = tokens[1]
			--print(name)

			local graph = {}
			local size = index/3 - 1

			for ii = 1,size do
				local triple = {}
				triple[1] = tonumber(tokens[3*ii + 1])
				triple[2] = tonumber(tokens[3*ii + 2])
				triple[3] = tonumber(tokens[3*ii + 3])
				graph[ii] = triple
			end

			local result = calculate_fdi(0, 86400, graph)

			local tdind = 0
			for key,value in pairs(result) do
				if(value[2]) then
						local td = (value[1] - 1357344000) / 86400
						tdind = tdind + 1
						assert(matlab[zz][tdind] == td, string.format('failed test: signal num = %d, alert num = %d, got %d instead of %d', zz, tdind, td, matlab[zz][tdind]))
				end
			end

		end
	end
end
